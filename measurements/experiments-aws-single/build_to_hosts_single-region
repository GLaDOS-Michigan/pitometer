#!/bin/bash
# This script builds ToyLock and RSL on the local machine, and copies the executable to the 
# target directory of the specified hosts. It takes the following positional arguments
# ./build_to_hosts [host_id...],
# where each host_id refers to the respective host in hosts.csv


HOSTS="aws-hosts_single-region.csv"
HOST_TARGET_DIR="/home/ubuntu/pitometer/measurements/experiments-aws-single"
RSL_DIR="../rsl-aws"
NETWORK_DIR="../network-aws"

# Do local build
./clean_builds
./$RSL_DIR/build
./$NETWORK_DIR/build

for i in "$@"
do
    tail -n +2 $HOSTS | while IFS=, read -r id name address port
    do
        if [ $id -eq $i ]
        then
            echo "Copying builds to $name"
            # scp network-aws-main rsl-main client.exe ubuntu@$address:$HOST_TARGET_DIR
            scp network-aws-main rsl-aws-main client.exe ubuntu@$address:$HOST_TARGET_DIR     
            break
        fi
    done
done

echo "Done build to hosts"
